labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)+
theme_minimal()
# Compute ROC
roc_obj <- roc(
response = pred_data$true_label,       # 0/1 labels
predictor = pred_data$predicted_value_1
)
# Extract TPR / FPR points
roc_df <- data.frame(
fpr = 1 - roc_obj$specificities,
tpr = roc_obj$sensitivities
)
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
) +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
ggplot2::annotate(
"text",
x = 0.95,
y = 0.2,
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
) +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
runApp()
shiny::runApp()
runApp()
attachment::att_amend_desc()
shiny::runApp()
usethis::use_package("plotly")
runApp()
runApp()
runApp()
usethis::use_package("plotly")
runApp()
runApp()
runApp()
?ggplotly
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
classif_type="major_classif"
food_category="Alcohol"
con <- pool::dbPool(
drv      = RPostgres::Postgres(),
dbname   = "eir_data",
host     = "localhost",
port     = 5432,
user     = "postgres",
password = "siddhi"
)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
View(pred_data)
library(dplyr)
pr_df <- pred_data %>%
arrange(desc(predicted_value_1)) %>%
mutate(
tp = cumsum(true_label == 1),
fp = cumsum(true_label == 0),
fn = sum(true_label == 1) - tp,
precision = tp / (tp + fp),
recall = tp / (tp + fn)
)
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
theme_minimal()
library(dplyr)
library(ggplot2)
pr_df <- pred_data %>%
arrange(desc(predicted_value_1)) %>%
mutate(
tp = cumsum(true_label == 1),
fp = cumsum(true_label == 0),
fn = sum(true_label == 1) - tp,
precision = tp / (tp + fp),
recall = tp / (tp + fn)
)
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
theme_minimal()
pr_auc <- sum(diff(pr_df$recall) * zoo::rollmean(pr_df$precision, 2))
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred", size = 1) +
ylim(0, 1) + xlim(0, 1) +
labs(
x = "Recall (TPR)",
y = "Precision (PPV)",
title = paste0("Precision–Recall Curve (AUC = ", round(pr_auc, 3), ")")
) +
theme_minimal()
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
ylim(0, 1) + xlim(0, 1) +
labs(
x = "Recall (TPR)",
y = "Precision (PPV)",
title = paste0("Precision–Recall Curve (AUC = ", round(pr_auc, 3), ")")
) +
theme_minimal()
golem::add_module(name = "pr_curve_plot")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?page_fluid
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?event_register
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
## Add modules ----
## Create a module infrastructure in R/
golem::add_module(name = "about")
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
runApp()
runApp()
shiny::runApp()
con <- pool::dbPool(
drv      = RPostgres::Postgres(),
dbname   = "eir_data",
host     = "localhost",
port     = 5432,
user     = "postgres",
password = "siddhi"
)
classif_type="major_classif"
food_category="Alcohol"
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_mapper <- DBI::dbGetQuery(con, q1)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM metrics WHERE category_id IN (", paste(category_id, collapse = ","),")")
metric_data <- DBI::dbGetQuery(con, q2)
rm(food_category)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_mapper <- DBI::dbGetQuery(con, q1)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM metrics WHERE category_id IN (", paste(category_id, collapse = ","),")")
metric_data <- DBI::dbGetQuery(con, q2)
View(metric_data)
View(category_mapper)
scatter_plot_data <- pred_data %>%
dplyr::mutate(
pred_class = ifelse(predicted_value_1 > predicted_value_0, "Positive", "Negative")
) %>%
dplyr::group_by(category_id, true_label_factor, pred_class) %>%
dplyr::summarise(true_positives = n(), .groups = "drop") %>%
dplyr::filter(true_label_factor == "Positive", pred_class == "Positive") %>%
dplyr::select(category_id, true_positives) %>%
dplyr::full_join(metric_data, by = "category_id") %>%
dplyr::full_join(category_mapper, by = "category_id") %>%
tidyr::pivot_longer(
cols = c(mcc, acc, roc_auc_macro, ap_macro),
names_to = "metric",
values_to = "value"
)
library(tidyr)
scatter_plot_data <- pred_data %>%
dplyr::mutate(
pred_class = ifelse(predicted_value_1 > predicted_value_0, "Positive", "Negative")
) %>%
dplyr::group_by(category_id, true_label_factor, pred_class) %>%
dplyr::summarise(true_positives = n(), .groups = "drop") %>%
dplyr::filter(true_label_factor == "Positive", pred_class == "Positive") %>%
dplyr::select(category_id, true_positives) %>%
dplyr::full_join(metric_data, by = "category_id") %>%
dplyr::full_join(category_mapper, by = "category_id") %>%
tidyr::pivot_longer(
cols = c(mcc, acc, roc_auc_macro, ap_macro),
names_to = "metric",
values_to = "value"
)
?n
library(dplyr)
scatter_plot_data <- pred_data %>%
dplyr::mutate(
pred_class = ifelse(predicted_value_1 > predicted_value_0, "Positive", "Negative")
) %>%
dplyr::group_by(category_id, true_label_factor, pred_class) %>%
dplyr::summarise(true_positives = n(), .groups = "drop") %>%
dplyr::filter(true_label_factor == "Positive", pred_class == "Positive") %>%
dplyr::select(category_id, true_positives) %>%
dplyr::full_join(metric_data, by = "category_id") %>%
dplyr::full_join(category_mapper, by = "category_id") %>%
tidyr::pivot_longer(
cols = c(mcc, acc, roc_auc_macro, ap_macro),
names_to = "metric",
values_to = "value"
)
View(scatter_plot_data)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(scatter_plot_data)
View(category_mapper)
View(category_mapper)
View(scatter_plot_data)
food_categ_id=5
scatter_plot_data %>%
dplyr::filter(category_id == food_categ_id)
runApp()
runApp()
#' helpers
#'
#' @description A utils function
#'
#' @return The return value, if any, from executing the utility.
#'
#' @noRd
#' @description A function to retrieve DB connection
#' @return DB connection
db_connect <- function(prod = golem::app_prod()) {
if (prod) {
conn <- DBI::dbConnect(
drv      = RPostgres::Postgres(),
dbname   = "eir_data",
host     = "localhost",
port     = 5432,
user     = "postgres",
password = "siddhi"
)
} else {
con <- pool::dbPool(
drv      = RPostgres::Postgres(),
dbname   = "eir_data",
host     = "localhost",
port     = 5432,
user     = "postgres",
password = "siddhi"
)
onStop(function() {
pool::poolClose(con)
})
}
return(con)
}
# pool <- pool::dbPool(
#   drv      = RPostgres::Postgres(),
#   dbname   = "eir_data",
#   host     = "localhost",
#   port     = 5432,
#   user     = "postgres",
#   password = "siddhi"
# )
# dbGetQuery(pool, "SELECT * FROM predictions LIMIT 5;")
#
# pool::poolClose(pool)
#classif_type="major_classif"
#food_category="Alcohol"
#' @description A function to extract "category" ids
#' @return category ids
category_mapper <- function(con, classif_type, food_category=NULL) {
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_mapper <- DBI::dbGetQuery(con, q1)
return(category_mapper)
}
#' @description A function to extract "prediction" data
#' @return prediction dataset
prediction_data <- function(con, classif_type, food_category=NULL) {
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
return(pred_data)
}
#' @description A function to extract "metrics" data
#' @return metric dataset
metrics_data <- function(con, classif_type, food_category=NULL) {
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM metrics WHERE category_id IN (", paste(category_id, collapse = ","),")")
metric_data <- DBI::dbGetQuery(con, q2)
return(metric_data)
}
runApp()
category_mapper(con = con, classif_type = "major_classif", food_category = "Alcohol")
category_mapper(con = con, classif_type = "major_classif", food_category = "Alcohol")$category_id
k <- category_mapper(con = con, classif_type = "major_classif", food_category = "Alcohol")$category_id
scatter_plot_data %>%
dplyr::filter(category_id == k)
runApp()
runApp()
runApp()
runApp()
runApp()
scatter_plot_data %>%
dplyr::filter(category_id %in% c(1,2))
category_mapper(con = con, classif_type = "major_classif", food_category = "Alcohol")$category_id
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
