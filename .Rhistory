)
return(ggplotly(p))
}
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_mapper <- DBI::dbGetQuery(con, q1)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM metrics WHERE category_id IN (", paste(category_id, collapse = ","),")")
metric_data <- DBI::dbGetQuery(con, q2)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
plot_data <- pred_data %>%
mutate(
pred_class = ifelse(predicted_value_1 > predicted_value_0, "Positive", "Negative")
) %>%
group_by(category_id, true_label_factor, pred_class) %>%
summarise(true_positives = n(), .groups = "drop") %>%
filter(true_label_factor == "Positive", pred_class == "Positive") %>%
select(category_id, true_positives) %>%
full_join(metric_data, by = "category_id") %>%
full_join(category_mapper, by = "category_id") %>%
pivot_longer(
cols = c(mcc, acc, roc_auc_macro, ap_macro),
names_to = "metric",
values_to = "value"
)
View(plot_data)
generate_scatter_plot(plot_data)
runApp()
runApp()
runApp()
?pivot_longer
runApp()
?ifelse
runApp()
runApp()
runApp()
runApp()
?ggplotly
runApp()
runApp()
runApp()
runApp()
runApp()
golem::add_module(name = "roc_curve_plot")
View(plot_data)
food_category="Alcohol"
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id,name FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_mapper <- DBI::dbGetQuery(con, q1)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM metrics WHERE category_id IN (", paste(category_id, collapse = ","),")")
metric_data <- DBI::dbGetQuery(con, q2)
View(metric_data)
View(pred_data)
head(pred_data)
usethis::use_package("yardstick")
roc_df <- roc_curve(pred_data, truth = true_label, .pred = predicted_value_1)
roc_df <- yardstick::roc_curve(pred_data, truth = true_label, .pred = predicted_value_1)
?roc_curve
roc_df <- yardstick::roc_curve(pred_data, truth = true_label, .pred = predicted_value_1)
rlang::last_trace()
yardstick::roc_curve(pred_data, truth = true_label, .pred = predicted_value_1)
View(pred_data)
pred_data_mod <- pred_data %>%
mutate(
true_label = factor(true_label, levels = c(0, 1))
)%>%
rename(.pred_1 = predicted_value_1)
yardstick::roc_curve(pred_data_mod, truth = true_label, .pred_1)
yardstick::roc_curve(pred_data_mod, truth = true_label, .pred_1) %>%
autoplot()
View(pred_data)
yardstick::roc_auc(pred_data_mod, truth = true_label, .pred_1) %>%
autoplot()
yardstick::roc_curve(pred_data_mod, truth = true_label, .pred_1) %>%
autoplot()
pred_data_mod <- pred_data %>%
mutate(
true_label = factor(true_label, levels = c(0, 1))
)%>%
rename(.pred_0 = predicted_value_0)
yardstick::roc_curve(pred_data_mod, truth = true_label, .pred_0) %>%
autoplot()
library(pROC)
library(ggplot2)
# Compute ROC
roc_obj <- roc(
response = pred_data$true_label,       # 0/1 labels
predictor = pred_data$predicted_value_1
)
# Extract TPR / FPR points
roc_df <- data.frame(
fpr = 1 - roc_obj$specificities,
tpr = roc_obj$sensitivities
)
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
usethis::use_package("pool")
usethis::use_package("bslib")
usethis::use_package("dplyr")
usethis::use_pipe()
usethis::use_package("DBI")
usethis::use_package("ggplot2")
usethis::use_package("pROC")
usethis::use_package("glue")
attachment::att_amend_desc()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)
# gsdbc -------------------------------------------------------------------
library(pROC)
library(ggplot2)
roc_obj <- pROC::roc(
response = pred_data$true_label,       # 0/1 labels
predictor = pred_data$predicted_value_1
)
roc_df <- data.frame(
fpr = 1 - roc_obj$specificities,
tpr = roc_obj$sensitivities
)
auc_val <- pROC::auc(roc_obj)
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)+
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)+
theme_minimal()
# Compute ROC
roc_obj <- roc(
response = pred_data$true_label,       # 0/1 labels
predictor = pred_data$predicted_value_1
)
# Extract TPR / FPR points
roc_df <- data.frame(
fpr = 1 - roc_obj$specificities,
tpr = roc_obj$sensitivities
)
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
)+
theme_minimal()
# Compute ROC
roc_obj <- roc(
response = pred_data$true_label,       # 0/1 labels
predictor = pred_data$predicted_value_1
)
# Extract TPR / FPR points
roc_df <- data.frame(
fpr = 1 - roc_obj$specificities,
tpr = roc_obj$sensitivities
)
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
ggplot2::annotate(
"text",
x = 0.95,
y = max(table(cut(pred_data$predicted_value_1, breaks = 30))),
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
) +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
# Plot
ggplot(roc_df, aes(x = fpr, y = tpr)) +
geom_line(color = "blue", size = 1) +
geom_abline(linetype = "dashed", color = "gray") +
ggplot2::annotate(
"text",
x = 0.95,
y = 0.2,
label = paste0("AUC: ", round(auc_val, 4)),
hjust = 1, vjust = 1,
size = 5,
fontface = "bold",
color = "black"
) +
labs(
x = "False Positive Rate",
y = "True Positive Rate",
title = paste0("ROC Curve (AUC = ", round(auc(roc_obj), 3), ")")
) +
theme_minimal()
runApp()
shiny::runApp()
runApp()
attachment::att_amend_desc()
shiny::runApp()
usethis::use_package("plotly")
runApp()
runApp()
runApp()
usethis::use_package("plotly")
runApp()
runApp()
runApp()
?ggplotly
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
classif_type="major_classif"
food_category="Alcohol"
con <- pool::dbPool(
drv      = RPostgres::Postgres(),
dbname   = "eir_data",
host     = "localhost",
port     = 5432,
user     = "postgres",
password = "siddhi"
)
if (!exists("food_category") || is.null(food_category) || food_category == "" || is.na(food_category)) {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type, "'")
} else {
q1 <- paste0("SELECT category_id FROM categories WHERE type = '", classif_type,
"' AND name = '", food_category, "'")
}
category_id <- DBI::dbGetQuery(con, q1)$category_id
q2 <- paste0("SELECT * FROM predictions WHERE category_id IN (", paste(category_id, collapse = ","),")")
pred_data <- DBI::dbGetQuery(con, q2) %>%
dplyr::mutate(true_label_factor = factor(true_label, levels = c(0, 1),
labels = c("Negative", "Positive")))
View(pred_data)
library(dplyr)
pr_df <- pred_data %>%
arrange(desc(predicted_value_1)) %>%
mutate(
tp = cumsum(true_label == 1),
fp = cumsum(true_label == 0),
fn = sum(true_label == 1) - tp,
precision = tp / (tp + fp),
recall = tp / (tp + fn)
)
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
theme_minimal()
library(dplyr)
library(ggplot2)
pr_df <- pred_data %>%
arrange(desc(predicted_value_1)) %>%
mutate(
tp = cumsum(true_label == 1),
fp = cumsum(true_label == 0),
fn = sum(true_label == 1) - tp,
precision = tp / (tp + fp),
recall = tp / (tp + fn)
)
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
theme_minimal()
pr_auc <- sum(diff(pr_df$recall) * zoo::rollmean(pr_df$precision, 2))
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred", size = 1) +
ylim(0, 1) + xlim(0, 1) +
labs(
x = "Recall (TPR)",
y = "Precision (PPV)",
title = paste0("Precision–Recall Curve (AUC = ", round(pr_auc, 3), ")")
) +
theme_minimal()
ggplot(pr_df, aes(x = recall, y = precision)) +
geom_line(color = "darkred") +
ylim(0, 1) + xlim(0, 1) +
labs(
x = "Recall (TPR)",
y = "Precision (PPV)",
title = paste0("Precision–Recall Curve (AUC = ", round(pr_auc, 3), ")")
) +
theme_minimal()
golem::add_module(name = "pr_curve_plot")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?page_fluid
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
?event_register
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
shiny::runApp()
